version: '3'

services:
    nginx:
        image: nginx:alpine
        depends_on:
          - client
        ports:
            - 80:80
        volumes:
            - './.docker/nginx/blog.conf:/etc/nginx/nginx.conf'
        links:
          - admin
          - client

    admin:
        image: php:7-4-cqrs-blog
        build:
            dockerfile: Dockerfile
            context: .docker/apache2
        volumes:
            - './blog:/var/www/html'
            - './.docker/apache2/admin.conf:/etc/apache2/sites-enabled/000-default.conf'

    client:
        image: php:7-4-cqrs-blog
        depends_on:
          - admin
        volumes:
            - './blog:/var/www/html'
            - './.docker/apache2/client.conf:/etc/apache2/sites-enabled/000-default.conf'
